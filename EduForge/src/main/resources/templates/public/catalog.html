<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/base :: layout(${pageTitle}, ~{::content})}">

<div th:fragment="content">
  
  <!-- Page Header -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h2 class="h4 fw-bold mb-1">
        <i class="bi bi-book text-primary me-2"></i>
        Catalogue des cours
      </h2>
      <p class="text-muted mb-0 small">Découvrez tous les cours publiés sur la plateforme</p>
    </div>
    <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
      <i class="bi bi-journals me-1"></i>
      <span th:text="${coursesCount + ' cours'}">0 cours</span>
    </span>
  </div>

  <!-- Search Card -->
  <div class="card mb-4">
    <div class="card-body p-4">
      <form class="row g-3" method="get" th:action="@{/catalog}">
        <div class="col-md-8">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input class="form-control border-start-0 ps-0" name="q" 
                   placeholder="Rechercher un cours par titre ou description…" 
                   th:value="${q}">
          </div>
        </div>
        <div class="col-md-4">
          <div class="d-flex gap-2">
            <button class="btn btn-primary flex-fill" type="submit">
              <i class="bi bi-search me-1"></i>Rechercher
            </button>
            <a class="btn btn-outline-secondary" th:href="@{/catalog}">
              <i class="bi bi-x-lg"></i>
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Results Grid -->
  <div class="row g-4">
    <!-- Empty State -->
    <div class="col-12" th:if="${#lists.isEmpty(courses)}">
      <div class="card text-center py-5">
        <div class="card-body">
          <i class="bi bi-journal-x text-muted" style="font-size: 4rem;"></i>
          <h5 class="mt-3">Aucun cours trouvé</h5>
          <p class="text-muted mb-3">
            <span th:if="${q != null && !q.isEmpty()}">Aucun résultat pour "<span th:text="${q}"></span>"</span>
            <span th:if="${q == null || q.isEmpty()}">Il n'y a pas encore de cours publiés sur la plateforme.</span>
          </p>
          <a class="btn btn-outline-primary" th:href="@{/catalog}" th:if="${q != null && !q.isEmpty()}">
            Voir tous les cours
          </a>
        </div>
      </div>
    </div>

    <!-- Course Cards -->
    <div class="col-md-6 col-lg-4" th:each="c : ${courses}">
      <div class="card h-100 course-card" style="transition: all 0.2s ease;">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div class="rounded-2 p-2 bg-primary bg-opacity-10">
              <i class="bi bi-journal-text text-primary"></i>
            </div>
            <span class="badge bg-success">
              <i class="bi bi-check-circle me-1"></i>Publié
            </span>
          </div>
          <h3 class="h6 fw-semibold mb-2" th:text="${c.title}">Titre du cours</h3>
          <p class="text-muted small flex-grow-1 mb-3" 
             th:if="${c.description}" 
             th:text="${#strings.abbreviate(c.description, 100)}"></p>
          <p class="text-muted small flex-grow-1 mb-3" th:unless="${c.description}">
            Aucune description disponible.
          </p>
          <div class="d-flex gap-2">
            <a class="btn btn-primary btn-sm flex-fill" th:href="@{|/course/${c.id}|}" sec:authorize="isAuthenticated()">
              <i class="bi bi-eye me-1"></i>Consulter
            </a>
            <a class="btn btn-outline-primary btn-sm flex-fill" th:href="@{/login}" sec:authorize="!isAuthenticated()">
              <i class="bi bi-box-arrow-in-right me-1"></i>Connectez-vous
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
.course-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 25px rgba(79, 70, 229, 0.1) !important;
}
</style>
</html>
