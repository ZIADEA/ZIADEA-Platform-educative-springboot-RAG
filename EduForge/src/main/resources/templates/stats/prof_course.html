<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(${pageTitle}, ~{::content})}">
<div th:fragment="content">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">Prof — Statistiques du cours</h2>
    <a class="btn btn-outline-secondary btn-sm" th:href="@{|/prof/courses/${course.id}|}">Retour</a>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <div class="fw-semibold" th:text="${course.title}"></div>
      <div class="text-muted small" th:text="${'Tentatives total: ' + totalAttempts}"></div>
      <div class="text-muted small" th:text="${'Moyenne (50 dernières): ' + #numbers.formatDecimal(avgRecent, 1, 2) + '%'}"></div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h3 class="h6">50 dernières tentatives</h3>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead><tr><th>Date</th><th>Étudiant</th><th>Score</th><th>Statut</th></tr></thead>
          <tbody>
            <tr th:each="a : ${recents}">
              <td th:text="${#temporals.format(a.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
              <td th:text="${a.studentId}"></td>
              <td th:text="${a.scorePercent + '% (' + a.correctCount + '/' + a.totalCount + ')'}"></td>
              <td>
                <span class="badge" th:classappend="${a.status.name()=='PASSED'?'text-bg-success':'text-bg-danger'}"
                      th:text="${a.status}"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
</html>
